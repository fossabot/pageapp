<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JSON格式化、语法检查及语法高亮工具</title>
<meta name="description" content="json,格式化,语法检查,高亮">
<meta name="keywords" content="json,格式化,语法检查,高亮">
<script type="text/javascript">
var jsonlint = function() {
    var a = !0,
    b = !1,
    c = {},
    d = function() {
        var a = {
            trace: function() {},
            yy: {},
            symbols_: {
                error: 2,
                JSONString: 3,
                STRING: 4,
                JSONNumber: 5,
                NUMBER: 6,
                JSONNullLiteral: 7,
                NULL: 8,
                JSONBooleanLiteral: 9,
                TRUE: 10,
                FALSE: 11,
                JSONText: 12,
                JSONValue: 13,
                EOF: 14,
                JSONObject: 15,
                JSONArray: 16,
                "{": 17,
                "}": 18,
                JSONMemberList: 19,
                JSONMember: 20,
                ":": 21,
                ",": 22,
                "[": 23,
                "]": 24,
                JSONElementList: 25,
                $accept: 0,
                $end: 1
            },
            terminals_: {
                2 : "error",
                4 : "<code>STRING</code>",
                6 : "<code>NUMBER</code>",
                8 : "<code>NULL</code>",
                10 : "<code>TRUE</code>",
                11 : "<code>FALSE</code>",
                14 : "<code>EOF</code>",
                17 : "<code>{</code>",
                18 : "<code>}</code>",
                21 : "<code>:</code>",
                22 : "<code>,</code>",
                23 : "<code>[</code>",
                24 : "<code>]</code>"
            },
            productions_: [0, [3, 1], [5, 1], [7, 1], [9, 1], [9, 1], [12, 2], [13, 1], [13, 1], [13, 1], [13, 1], [13, 1], [13, 1], [15, 2], [15, 3], [20, 3], [19, 1], [19, 3], [16, 2], [16, 3], [25, 1], [25, 3]],
            performAction: function(b, c, d, e, f, g, h) {
                var i = g.length - 1;
                switch (f) {
                case 1:
                    this.$ = b.replace(/\\(\\|")/g, "$1").replace(/\\n/g, "\n").replace(/\\r/g, "\r").replace(/\\t/g, " ").replace(/\\v/g, "").replace(/\\f/g, "\f").replace(/\\b/g, "\b");
                    break;
                case 2:
                    this.$ = Number(b);
                    break;
                case 3:
                    this.$ = null;
                    break;
                case 4:
                    this.$ = !0;
                    break;
                case 5:
                    this.$ = !1;
                    break;
                case 6:
                    return this.$ = g[i - 1];
                case 13:
                    this.$ = {};
                    break;
                case 14:
                    this.$ = g[i - 1];
                    break;
                case 15:
                    this.$ = [g[i - 2], g[i]];
                    break;
                case 16:
                    this.$ = {}, this.$[g[i][0]] = g[i][1];
                    break;
                case 17:
                    this.$ = g[i - 2], g[i - 2][g[i][0]] = g[i][1];
                    break;
                case 18:
                    this.$ = [];
                    break;
                case 19:
                    this.$ = g[i - 1];
                    break;
                case 20:
                    this.$ = [g[i]];
                    break;
                case 21:
                    this.$ = g[i - 2], g[i - 2].push(g[i])
                }
            },
            table: [{
                3 : 5,
                4 : [1, 12],
                5 : 6,
                6 : [1, 13],
                7 : 3,
                8 : [1, 9],
                9 : 4,
                10 : [1, 10],
                11 : [1, 11],
                12 : 1,
                13 : 2,
                15 : 7,
                16 : 8,
                17 : [1, 14],
                23 : [1, 15]
            }, {
                1 : [3]
            }, {
                14 : [1, 16]
            }, {
                14 : [2, 7],
                18 : [2, 7],
                22 : [2, 7],
                24 : [2, 7]
            }, {
                14 : [2, 8],
                18 : [2, 8],
                22 : [2, 8],
                24 : [2, 8]
            }, {
                14 : [2, 9],
                18 : [2, 9],
                22 : [2, 9],
                24 : [2, 9]
            }, {
                14 : [2, 10],
                18 : [2, 10],
                22 : [2, 10],
                24 : [2, 10]
            }, {
                14 : [2, 11],
                18 : [2, 11],
                22 : [2, 11],
                24 : [2, 11]
            }, {
                14 : [2, 12],
                18 : [2, 12],
                22 : [2, 12],
                24 : [2, 12]
            }, {
                14 : [2, 3],
                18 : [2, 3],
                22 : [2, 3],
                24 : [2, 3]
            }, {
                14 : [2, 4],
                18 : [2, 4],
                22 : [2, 4],
                24 : [2, 4]
            }, {
                14 : [2, 5],
                18 : [2, 5],
                22 : [2, 5],
                24 : [2, 5]
            }, {
                14 : [2, 1],
                18 : [2, 1],
                21 : [2, 1],
                22 : [2, 1],
                24 : [2, 1]
            }, {
                14 : [2, 2],
                18 : [2, 2],
                22 : [2, 2],
                24 : [2, 2]
            }, {
                3 : 20,
                4 : [1, 12],
                18 : [1, 17],
                19 : 18,
                20 : 19
            }, {
                3 : 5,
                4 : [1, 12],
                5 : 6,
                6 : [1, 13],
                7 : 3,
                8 : [1, 9],
                9 : 4,
                10 : [1, 10],
                11 : [1, 11],
                13 : 23,
                15 : 7,
                16 : 8,
                17 : [1, 14],
                23 : [1, 15],
                24 : [1, 21],
                25 : 22
            }, {
                1 : [2, 6]
            }, {
                14 : [2, 13],
                18 : [2, 13],
                22 : [2, 13],
                24 : [2, 13]
            }, {
                18 : [1, 24],
                22 : [1, 25]
            }, {
                18 : [2, 16],
                22 : [2, 16]
            }, {
                21 : [1, 26]
            }, {
                14 : [2, 18],
                18 : [2, 18],
                22 : [2, 18],
                24 : [2, 18]
            }, {
                22 : [1, 28],
                24 : [1, 27]
            }, {
                22 : [2, 20],
                24 : [2, 20]
            }, {
                14 : [2, 14],
                18 : [2, 14],
                22 : [2, 14],
                24 : [2, 14]
            }, {
                3 : 20,
                4 : [1, 12],
                20 : 29
            }, {
                3 : 5,
                4 : [1, 12],
                5 : 6,
                6 : [1, 13],
                7 : 3,
                8 : [1, 9],
                9 : 4,
                10 : [1, 10],
                11 : [1, 11],
                13 : 30,
                15 : 7,
                16 : 8,
                17 : [1, 14],
                23 : [1, 15]
            }, {
                14 : [2, 19],
                18 : [2, 19],
                22 : [2, 19],
                24 : [2, 19]
            }, {
                3 : 5,
                4 : [1, 12],
                5 : 6,
                6 : [1, 13],
                7 : 3,
                8 : [1, 9],
                9 : 4,
                10 : [1, 10],
                11 : [1, 11],
                13 : 31,
                15 : 7,
                16 : 8,
                17 : [1, 14],
                23 : [1, 15]
            }, {
                18 : [2, 17],
                22 : [2, 17]
            }, {
                18 : [2, 15],
                22 : [2, 15]
            }, {
                22 : [2, 21],
                24 : [2, 21]
            }],
            defaultActions: {
                16 : [2, 6]
            },
            parseError: function(b, c) {
                throw new Error(b)
            },
            parse: function(b) {
                function o(a) {
                    d.length = d.length - 2 * a, e.length = e.length - a, f.length = f.length - a
                }
                function p() {
                    var a;
                    return a = c.lexer.lex() || 1, typeof a != "number" && (a = c.symbols_[a] || a), a
                }
                var c = this,
                d = [0],
                e = [null],
                f = [],
                g = this.table,
                h = "",
                i = 0,
                j = 0,
                k = 0,
                l = 2,
                m = 1;
                this.lexer.setInput(b), this.lexer.yy = this.yy, this.yy.lexer = this.lexer, typeof this.lexer.yylloc == "undefined" && (this.lexer.yylloc = {});
                var n = this.lexer.yylloc;
                f.push(n), typeof this.yy.parseError == "function" && (this.parseError = this.yy.parseError);
                var q, r, s, t, u, v, w = {}, x, y, z, A;
                for (;;) {
                    s = d[d.length - 1], this.defaultActions[s] ? t = this.defaultActions[s] : (q == null && (q = p()), t = g[s] && g[s][q]);
                    if (typeof t == "undefined" || !t.length || !t[0]) {
                        if (!k) {
                            A = [];
                            for (x in g[s]) this.terminals_[x] && x > 2 && A.push(this.terminals_[x]);
                            var B = "";
                            selectTextareaLine($id("RawJson"), i);
                            this.lexer.showPosition ? B = "在第" + (i + 1) + "行发生解析错误 " + ":<br/>" + this.lexer.showPosition() + "<br/>此处缺少" + A.join(", ") + "字符, 实际上确是一个 " + this.terminals_[q] : B = "在第" + (i + 1) + "行发生解析错误 " + ": 本应该是 " + (q == 1 ? "结尾输入": "'" + (this.terminals_[q] || q) + "'"), this.parseError(B, {
                                text: this.lexer.match,
                                token: this.terminals_[q] || q,
                                line: this.lexer.yylineno,
                                loc: n,
                                expected: A
                            })
                        }
                        if (k == 3) {
                            if (q == m) throw new Error(B || "解析意外终止.");
                            j = this.lexer.yyleng, h = this.lexer.yytext, i = this.lexer.yylineno, n = this.lexer.yylloc, q = p();
                        }
                        for (;;) {
                            if (l.toString() in g[s]) break;
                            if (s == 0) throw new Error(B || "解析意外终止.");
                            o(1), s = d[d.length - 1]
                        }
                        r = q, q = l, s = d[d.length - 1], t = g[s] && g[s][l], k = 3;
                    }
                    if (t[0] instanceof Array && t.length > 1) throw new Error("解析错误: multiple actions possible at state: " + s + ", token: " + q);
                    switch (t[0]) {
                    case 1:
                        d.push(q), e.push(this.lexer.yytext), f.push(this.lexer.yylloc), d.push(t[1]), q = null, r ? (q = r, r = null) : (j = this.lexer.yyleng, h = this.lexer.yytext, i = this.lexer.yylineno, n = this.lexer.yylloc, k > 0 && k--);
                        break;
                    case 2:
                        y = this.productions_[t[1]][1], w.$ = e[e.length - y], w._$ = {
                            first_line: f[f.length - (y || 1)].first_line,
                            last_line: f[f.length - 1].last_line,
                            first_column: f[f.length - (y || 1)].first_column,
                            last_column: f[f.length - 1].last_column
                        }, v = this.performAction.call(w, h, j, i, this.yy, t[1], e, f);
                        if (typeof v != "undefined") return v;
                        y && (d = d.slice(0, -1 * y * 2), e = e.slice(0, -1 * y), f = f.slice(0, -1 * y)), d.push(this.productions_[t[1]][0]), e.push(w.$), f.push(w._$), z = g[d[d.length - 2]][d[d.length - 1]], d.push(z);
                        break;
                    case 3:
                        return ! 0
                    }
                }
                return ! 0
            }
        },
        b = function() {
            var a = {
                EOF: 1,
                parseError: function(b, c) {
                    if (!this.yy.parseError) throw new Error(b);
                    this.yy.parseError(b, c)
                },
                setInput: function(a) {
                    return this._input = a, this._more = this._less = this.done = !1, this.yylineno = this.yyleng = 0, this.yytext = this.matched = this.match = "", this.conditionStack = ["INITIAL"], this.yylloc = {
                        first_line: 1,
                        first_column: 0,
                        last_line: 1,
                        last_column: 0
                    }, this
                },
                input: function() {
                    var a = this._input[0];
                    this.yytext += a, this.yyleng++, this.match += a, this.matched += a;
                    var b = a.match(/\n/);
                    return b && this.yylineno++, this._input = this._input.slice(1), a
                },
                unput: function(a) {
                    return this._input = a + this._input, this
                },
                more: function() {
                    return this._more = !0, this
                },
                less: function(a) {
                    this._input = this.match.slice(a) + this._input
                },
                pastInput: function() {
                    var a = this.matched.substr(0, this.matched.length - this.match.length);
                    return (a.length > 20 ? "...": "") + a.substr( - 20).replace(/\n/g, "")
                },
                upcomingInput: function() {
                    var a = this.match;
                    return a.length < 20 && (a += this._input.substr(0, 20 - a.length)), (a.substr(0, 20) + (a.length > 20 ? "...": "")).replace(/\n/g, "")
                },
                showPosition: function() {
                    var a = this.pastInput(),
                    b = (new Array(a.length + 1 - 5)).join("&nbsp;");
                    return "<code>" + a + this.upcomingInput() + "</code><br/>" + b + '<i class="fa fa-arrow-up" style="color:green;"></i>'
                },
                next: function() {
                    if (this.done) return this.EOF;
                    this._input || (this.done = !0);
                    var a, b, c, d, e, f;
                    this._more || (this.yytext = "", this.match = "");
                    var g = this._currentRules();
                    for (var h = 0; h < g.length; h++) {
                        c = this._input.match(this.rules[g[h]]);
                        if (c && (!b || c[0].length > b[0].length)) {
                            b = c, d = h;
                            if (!this.options.flex) break
                        }
                    }
                    if (b) {
                        f = b[0].match(/\n.*/g), f && (this.yylineno += f.length), this.yylloc = {
                            first_line: this.yylloc.last_line,
                            last_line: this.yylineno + 1,
                            first_column: this.yylloc.last_column,
                            last_column: f ? f[f.length - 1].length - 1 : this.yylloc.last_column + b[0].length
                        }, this.yytext += b[0], this.match += b[0], this.yyleng = this.yytext.length, this._more = !1, this._input = this._input.slice(b[0].length), this.matched += b[0], a = this.performAction.call(this, this.yy, this, g[d], this.conditionStack[this.conditionStack.length - 1]), this.done && this._input && (this.done = !1);
                        if (a) return a;
                        return
                    }
                    if (this._input === "") return this.EOF;
                    selectTextareaLine($id("RawJson"), this.yylineno);
                    this.parseError("词汇错误发生在第" + (this.yylineno + 1) + "行. 不能识别的字符.<br/>" + this.showPosition(), {
                        text: "",
                        token: null,
                        line: this.yylineno
                    })
                },
                lex: function() {
                    var b = this.next();
                    return typeof b != "undefined" ? b: this.lex()
                },
                begin: function(b) {
                    this.conditionStack.push(b)
                },
                popState: function() {
                    return this.conditionStack.pop()
                },
                _currentRules: function() {
                    return this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules
                },
                topState: function() {
                    return this.conditionStack[this.conditionStack.length - 2]
                },
                pushState: function(b) {
                    this.begin(b)
                }
            };
            return a.options = {}, a.performAction = function(b, c, d, e) {
                var f = e;
                switch (d) {
                case 0:
                    break;
                case 1:
                    return 6;
                case 2:
                    return c.yytext = c.yytext.substr(1, c.yyleng - 2), 4;
                case 3:
                    return 17;
                case 4:
                    return 18;
                case 5:
                    return 23;
                case 6:
                    return 24;
                case 7:
                    return 22;
                case 8:
                    return 21;
                case 9:
                    return 10;
                case 10:
                    return 11;
                case 11:
                    return 8;
                case 12:
                    return 14;
                case 13:
                    return "INVALID"
                }
            }, a.rules = [/^(?:\s+)/, /^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/, /^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/, /^(?:\{)/, /^(?:\})/, /^(?:\[)/, /^(?:\])/, /^(?:,)/, /^(?::)/, /^(?:true\b)/, /^(?:false\b)/, /^(?:null\b)/, /^(?:$)/, /^(?:.)/], a.conditions = {
                INITIAL: {
                    rules: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
                    inclusive: !0
                }
            }, a
        } ();
        return a.lexer = b, a
    } ();
    return typeof a != "undefined" && typeof c != "undefined" && (c.parser = d, c.parse = function() {
        return d.parse.apply(d, arguments)
    }, c.main = function(d) {
        if (!d[1]) throw new Error("Usage: " + d[0] + " FILE");
        if (typeof process != "undefined") var e = a("fs").readFileSync(a("path").join(process.cwd(), d[1]), "utf8");
        else var f = a("file").path(a("file").cwd()),
        e = f.join(d[1]).read({
            charset: "utf-8"
        });
        return c.parser.parse(e)
    }, typeof b != "undefined" && a.main === b && c.main(typeof process != "undefined" ? process.argv.slice(1) : a("system").args)), c
} ();

function selectTextareaLine(tarea,lineIdx) {
    var lines = tarea.value.split("\n");

    // calculate start/end
    var startPos = 0, endPos = tarea.value.length;
    for(var x = 0; x < lines.length; x++) {
        if(x == lineIdx) {
            break;
        }
        startPos += (lines[x].length+1);
    }

    var endPos = lines[lineIdx].length+startPos;

    // do selection in Chrome / Firefox
    if(typeof(tarea.selectionStart) != "undefined") {
        tarea.focus();
        tarea.selectionStart = startPos;
        tarea.selectionEnd = endPos;
        // scroll to the selected line
        tarea.scrollTop = tarea.scrollHeight / lines.length * lineIdx;
        return true;
    }

     // IE
     if (document.selection && document.selection.createRange) {
        tarea.focus();
        tarea.select();
        var range = document.selection.createRange();
        range.collapse(true);
        range.moveEnd("character", endPos);
        range.moveStart("character", startPos);
        range.select();
        // scroll to the selected line
        tarea.scrollTop = tarea.scrollHeight / lines.length * lineIdx;
        return true;
    }

    return false;
}
</script>
<script type="text/javascript">
window.SINGLE_TAB = " ";
window.ImgCollapsed = "data:image/gif;base64,R0lGODlhHAALAMQAAP////7++/z8/Pb29fb18PHx7e/w6/Hw6e3s5unp4+jm2ODg3t3a0dnVy9bQxtLMv8zJurDC1L+9sMK4p32buDMzMwAAAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEHABcALAAAAAAcAAsAAAVU4CWOZGmeV0StLBWhsEgBdA1QMUwJvMUTuNyJMihaBodFUFiiECxQKGMpqlSq14uVRCkUEJbEokHVZrdmrqLRsDgekDLzQoFIJni8nKlqrV5zgYIhADs=";
window.ImgExpanded = "data:image/gif;base64,R0lGODlhHAALAMQAAP////7++/z8/Pb29fb18PHx7e/w6/Hw6e3s5unp4+Dg3t3a0djY0dnVy9fTxNbQxtLMv8zJurDC1L+9sMK4p32buAAAAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEHABcALAAAAAAcAAsAAAVL4CWOZGmel1StbCWhsFgBdA1UMVwJQd8TuNypMigWD4qgsFQhWJ7PhXI5qhQKCERC0ZhSLxUFo+FwQCJeagUyobjd6aWqtXp979QQADs=";
window.QuoteKeys = true;
function $id(id) {
    return document.getElementById(id);
}
function IsArray(obj) {
    return obj && typeof obj === 'object' && typeof obj.length === 'number' && !(obj.propertyIsEnumerable('length'));
}

function Process() {
    SetTab();
    window.IsCollapsible = $id("CollapsibleView").checked;
    var json = $id("RawJson").value;

    try {
        if (json == "") {
            json = "\"\"";
        }
        var lintJson = jsonlint.parse(json.trim());
        json = JSON.stringify(lintJson);
        var obj = eval("[" + json + "]");
        var html = ProcessObject(obj[0], 0, false, false, false);
        $id("Canvas").innerHTML = "<PRE class='CodeContainer'>" + html + "</PRE>";
    } catch(e) {
        $id("Canvas").innerHTML = '<span style="color: #f1592a;font-weight:bold;">' + e + '</span>';
    }
}

window._dateObj = new Date();
window._regexpObj = new RegExp();
function ProcessObject(obj, indent, addComma, isArray, isPropertyContent) {
    var html = "";
    var comma = (addComma) ? "<span class='Comma'>,</span> ": "";
    var type = typeof obj;
    var clpsHtml = "";
    if (IsArray(obj)) {
        if (obj.length == 0) {
            html += GetRow(indent, "<span class='ArrayBrace'>[ ]</span>" + comma, isPropertyContent);
        } else {
            clpsHtml = window.IsCollapsible ? "<span><img src=\"" + window.ImgExpanded + "\" onClick=\"ExpImgClicked(this)\" /></span><span class='collapsible'>": "";
            html += GetRow(indent, "<span class='ArrayBrace'>[</span>" + clpsHtml, isPropertyContent);
            for (var i = 0; i < obj.length; i++) {
                html += ProcessObject(obj[i], indent + 1, i < (obj.length - 1), true, false);
            }
            clpsHtml = window.IsCollapsible ? "</span>": "";
            html += GetRow(indent, clpsHtml + "<span class='ArrayBrace'>]</span>" + comma);
        }
    } else if (type == 'object') {
        if (obj == null) {
            html += FormatLiteral("null", "", comma, indent, isArray, "Null");
        } else if (obj.constructor == window._dateObj.constructor) {
            html += FormatLiteral("new Date(" + obj.getTime() + ") /*" + obj.toLocaleString() + "*/", "", comma, indent, isArray, "Date");
        } else if (obj.constructor == window._regexpObj.constructor) {
            html += FormatLiteral("new RegExp(" + obj + ")", "", comma, indent, isArray, "RegExp");
        } else {
            var numProps = 0;
            for (var prop in obj) numProps++;
            if (numProps == 0) {
                html += GetRow(indent, "<span class='ObjectBrace'>{ }</span>" + comma, isPropertyContent);
            } else {
                clpsHtml = window.IsCollapsible ? "<span><img src=\"" + window.ImgExpanded + "\" onClick=\"ExpImgClicked(this)\" /></span><span class='collapsible'>": "";
                html += GetRow(indent, "<span class='ObjectBrace'>{</span>" + clpsHtml, isPropertyContent);
                var j = 0;
                for (var prop in obj) {
                    var quote = window.QuoteKeys ? "\"": "";
                    html += GetRow(indent + 1, "<span class='PropertyName'>" + quote + prop + quote + "</span>: " + ProcessObject(obj[prop], indent + 1, ++j < numProps, false, true));
                }
                clpsHtml = window.IsCollapsible ? "</span>": "";
                html += GetRow(indent, clpsHtml + "<span class='ObjectBrace'>}</span>" + comma);
            }
        }
    } else if (type == 'number') {
        html += FormatLiteral(obj, "", comma, indent, isArray, "Number");
    } else if (type == 'boolean') {
        html += FormatLiteral(obj, "", comma, indent, isArray, "Boolean");
    } else if (type == 'function') {
        if (obj.constructor == window._regexpObj.constructor) {
            html += FormatLiteral("new RegExp(" + obj + ")", "", comma, indent, isArray, "RegExp");
        } else {
            obj = FormatFunction(indent, obj);
            html += FormatLiteral(obj, "", comma, indent, isArray, "Function");
        }
    } else if (type == 'undefined') {
        html += FormatLiteral("undefined", "", comma, indent, isArray, "Null");
    } else {
        html += FormatLiteral(obj.toString().split("\\").join("\\\\").split('"').join('\\"'), "\"", comma, indent, isArray, "String");
    }
    return html;
}

function FormatLiteral(literal, quote, comma, indent, isArray, style) {
    if (typeof literal == 'string') {
        literal = literal.split("<").join("&lt;").split(">").join("&gt;");
    }
    var str = "<span class='" + style + "'>" + quote + literal + quote + comma + "</span>";
    if (isArray) {
        str = GetRow(indent, str);
    }
    return str;
}

function FormatFunction(indent, obj) {
    var tabs = "";
    for (var i = 0; i < indent; i++) tabs += window.TAB;
    var funcStrArray = obj.toString().split("\n");
    var str = "";
    for (var i = 0; i < funcStrArray.length; i++) {
        str += ((i == 0) ? "": tabs) + funcStrArray[i] + "\n";
    }
    return str;
}

function GetRow(indent, data, isPropertyContent) {
    var tabs = "";
    for (var i = 0; i < indent && !isPropertyContent; i++) tabs += window.TAB;
    if (data != null && data.length > 0 && data.charAt(data.length - 1) != "\n") {
        data = data + "\n";
    }
    return tabs + data;
}

function CollapsibleViewClicked() {
    $id("CollapsibleViewDetail").style.visibility = $id("CollapsibleView").checked ? "visible": "hidden";
    Process();
}

function QuoteKeysClicked() {
    window.QuoteKeys = $id("QuoteKeys").checked;
    Process();
}

function CollapseAllClicked() {
    EnsureIsPopulated();
    TraverseChildren($id("Canvas"),
    function(element) {
        if (element.className == 'collapsible') {
            MakeContentVisible(element, false);
        }
    },
    0);
}

function ExpandAllClicked() {
    EnsureIsPopulated();
    TraverseChildren($id("Canvas"),
    function(element) {
        if (element.className == 'collapsible') {
            MakeContentVisible(element, true);
        }
    },
    0);
}

function MakeContentVisible(element, visible) {
    var img = element.previousSibling.firstChild;
    if ( !! img.tagName && img.tagName.toLowerCase() == "img") {
        element.style.display = visible ? 'inline': 'none';
        element.previousSibling.firstChild.src = visible ? window.ImgExpanded: window.ImgCollapsed;
    }
}

function TraverseChildren(element, func, depth) {
    for (var i = 0; i < element.childNodes.length; i++) {
        TraverseChildren(element.childNodes[i], func, depth + 1);
    }
    func(element, depth);
}

function ExpImgClicked(img) {
    var container = img.parentNode.nextSibling;
    if (!container) return;
    var disp = "none";
    var src = window.ImgCollapsed;
    if (container.style.display == "none") {
        disp = "inline";
        src = window.ImgExpanded;
    }
    container.style.display = disp;
    img.src = src;
}

function CollapseLevel(level) {
    EnsureIsPopulated();
    TraverseChildren($id("Canvas"),
    function(element, depth) {
        if (element.className == 'collapsible') {
            if (depth >= level) {
                MakeContentVisible(element, false);
            } else {
                MakeContentVisible(element, true);
            }
        }
    },
    0);
}

function TabSizeChanged() {
    Process();
}

function SetTab() {
    var select = $id("TabSize");
    window.TAB = MultiplyString(parseInt(select.options[select.selectedIndex].value), window.SINGLE_TAB);
}

function EnsureIsPopulated() {
    if (!$id("Canvas").innerHTML && !!$id("RawJson").value) Process();
}

function MultiplyString(num, str) {
    var sb = [];
    for (var i = 0; i < num; i++) {
        sb.push(str);
    }
    return sb.join("");
}

function SelectAllClicked() {
    if (!!document.selection && !!document.selection.empty) {
        document.selection.empty();
    } else if (!!window.getSelection) {
        var sel = window.getSelection();
        if (sel.removeAllRanges) {
            window.getSelection().removeAllRanges();
        }
    }

    var range = (!!document.body && !!document.body.createTextRange) ? document.body.createTextRange() : document.createRange();

    if (!!range.selectNode) {
        range.selectNode($id("Canvas"));
    } else if (range.moveToElementText) {
        range.moveToElementText($id("Canvas"));
    }

    if (!!range.select) {
        range.select($id("Canvas"));
    } else {
        window.getSelection().addRange(range);
    }
}

function Copy() {
    SelectAllClicked();
    if (document.execCommand('copy')) {
        document.getSelection().removeAllRanges();
    }
}

window.onload = function() {
    refreshlines();
    $id("RawJson").onscroll = function () {
        $id("divlines").style.top = -($id("RawJson").scrollTop) + "px";
        return true;
    }
    $id("RawJson").onkeyup = function () {
        refreshlines();
        return true;
    }
}

function refreshlines() {
    var nLines = $id("RawJson").value.split("\n").length;
    var text = "";
    for (i=1; i<=nLines; i++) {
        if (i < 10) {
            text += "&nbsp;&nbsp;&nbsp;" + i + "<br>";
        } else if (i < 100) {
            text += "&nbsp;&nbsp;" + i + "<br>";
        } else if (i < 1000) {
            text += "&nbsp;" + i + "<br>";
        } else if (i < 10000) {
            text += i + "<br>";
        } else {
            var j = i.toString();
            text += '<span title="'+i+'">'+j.substring(j.length-4, j.length)+'</span><br>'
        }
    }
    $id("divlines").innerHTML = text;
    $id("divlines").style.top = -($id("RawJson").scrollTop) + "px";     
}
</script>
<style type="text/css" rel="stylesheet">
@charset "utf-8";
/* CSS Document */
div.ControlsRow, div.HeadersRow {
  font-family: Georgia;
}

div.Canvas {
  font-family: Lucida Console, Georgia;
  font-size: 13px;
  background-color: #ECECEC;
  color: #000000;
  border: solid 1px #CECECE;
  margin-top: 5px;
  padding: 5px;
  width: 99%;
}

.ObjectBrace {
  color: #00AA00;
  font-weight: bold;
}

.ArrayBrace {
  color: #0033FF;
  font-weight: bold;
}

.PropertyName {
  color: rgba(200, 0, 0, 0.5);
  font-weight: bold;
}

.String {
  color: #007777;
}

.Number {
  color: #AA00AA;
  font-weight: bold;
}

.Boolean {
  color: #FF00FF;
  font-weight: bold;
}

.Function {
  color: #AA6633;
  text-decoration: italic;
}

.Null {
  color: #0000FF;
}

.Comma {
  color: #000000;
  font-weight: bold;
}

PRE.CodeContainer {
  margin-top: 0px;
  margin-bottom: 0px;
}

PRE.CodeContainer img {
  cursor: pointer;
  border: none;
  margin-bottom: -1px;
}

#CollapsibleViewDetail a {
  padding-left: 10px;
}

#ControlsRow {
  white-space: nowrap;
  margin-left: 33px;
}

#TabSizeHolder {
  padding-left: 10px;
  padding-right: 10px;
  color: #4CAF50;
  font: 16px Courier New;
}

#HeaderTitle {
  text-align: right;
  font-size: 11px;
  color: gray;
}

#HeaderSubTitle {
  margin-bottom: 2px;
  margin-top: 0px;
  text-align: center;
  color: #4CAF50;
}

#RawJson {
  width: 99%;
  height: 100%;
  overflow-x: scroll;
  font-family: Courier New;
  font-size: 14px;
  resize: none;
  padding-top: 0.8px !important;
}

A.OtherToolsLink {
  color: #555;
  text-decoration: none;
}

A.OtherToolsLink:hover {
  text-decoration: underline;
}

code{
  padding: 2px 4px;
  font-size: 14px;
  color: #c7254e;
  background-color: #f9f2f4;
  border-radius: 4px;
}

#container {
  width: 35px;
  height: 300px;
  float: left;
  color: Gray;
  font-family: Courier New;
  font-size: 14px;
  overflow: hidden;
  position: relative;
}

#divlines {
  position: absolute;
  text-align: right;
  text-decoration: underline;
}

input[type=button] {
    background-color: #4CAF50; /* Green */
    border: none;
    color: white;
    padding: 2px 6px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
}
input[type=button]:hover {
    box-shadow: 0 6px 8px 0 rgba(0,0,0,0.24),0 8px 20px 0 rgba(76,175,80,1);
}

.control {
  display: inline;
  position: relative;
  padding-left: 30px;
  margin-bottom: 15px;
  cursor: pointer;
  color: #4CAF50;
  font: 16px Courier New;
}
.control input {
  position: absolute;
  z-index: -1;
  opacity: 0;
}
.control__indicator {
  position: absolute;
  top: -1px;
  left: 0;
  height: 20px;
  width: 20px;
  background: #e6e6e6;
}
.control:hover input ~ .control__indicator,
.control input:focus ~ .control__indicator {
  background: #ccc;
}
.control input:checked ~ .control__indicator {
  background: #4CAF50;
}
.control:hover input:not([disabled]):checked ~ .control__indicator,
.control input:checked:focus ~ .control__indicator {
  background: #4CAF50;
}
.control input:disabled ~ .control__indicator {
  background: #e6e6e6;
  opacity: 0.6;
  pointer-events: none;
}
.control__indicator:after {
  content: '';
  position: absolute;
  display: none;
}
.control input:checked ~ .control__indicator:after {
  display: block;
}
.control--checkbox .control__indicator:after {
  left: 8px;
  top: 4px;
  width: 3px;
  height: 8px;
  border: solid #fff;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}
.control--checkbox input:disabled ~ .control__indicator:after {
  border-color: #7b7b7b;
}

select#TabSize {
   font: 14px Courier New;
   border: 0;
   padding: 1px 3px;
   color: #FFFFFF;
   background-color: #4CAF50;
}
</style>
</head>
<body>
<div class="HeadersRow">
  <div id="HeaderTitle">
  Web单页可离线 JSON格式化、语法检查、语法高亮工具 &nbsp;©&nbsp;2017&nbsp;&nbsp; 
  <a style="text-decoration: none !important;" target="_blank" href="https://github.com/yougg/pageapp/tree/master/json">yougg</a>
  </div>
  <h3 id="HeaderSubTitle">JSON格式化、语法检查、语法高亮</h3>
  <table style="width:98%;" cellspacing="0" cellpadding="0">
    <tr>
      <td style="width: 35px;">
        <div id="container">
          <div id="divlines"></div>
        </div>
      </td>
      <td style="height: 300px;">
        <textarea id="RawJson" wrap="off" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Input JSON here..."></textarea>
      </td>
    </tr>
  </table>
</div>
<div id="ControlsRow">
  <input type="Button" value="格式化" onclick="Process()">
  <span id="TabSizeHolder">
    缩进量
    <select id="TabSize" onchange="TabSizeChanged()">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4" selected="selected">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>
  </span>
  <label for="QuoteKeys" class="control control--checkbox">引号
      <input type="checkbox" id="QuoteKeys" onclick="QuoteKeysClicked()" checked="checked"/>
      <div class="control__indicator"></div>
  </label>
  &nbsp;
  <input type="Button" value="全选" onclick="SelectAllClicked()">
  &nbsp;
  <input type="Button" value="复制" onclick="Copy()">
  <span id="CollapsibleViewHolder">
    <label for="CollapsibleView" class="control control--checkbox">
      显示控制
      <input type="checkbox" id="CollapsibleView" onclick="CollapsibleViewClicked()" checked="checked"/>
      <div class="control__indicator"></div>
    </label>
  </span>
  <span id="CollapsibleViewDetail">
    <input type="Button" value="全部展开" onclick="ExpandAllClicked()">
    <input type="Button" value="全部折叠" onclick="CollapseAllClicked()">
    <input type="Button" value="2级" style="padding:1px;" onclick="CollapseLevel(3)">
    <input type="Button" value="3级" style="padding:1px;" onclick="CollapseLevel(4)">
    <input type="Button" value="4级" style="padding:1px;" onclick="CollapseLevel(5)">
    <input type="Button" value="5级" style="padding:1px;" onclick="CollapseLevel(6)">
    <input type="Button" value="6级" style="padding:1px;" onclick="CollapseLevel(7)">
    <input type="Button" value="7级" style="padding:1px;" onclick="CollapseLevel(8)">
    <input type="Button" value="8级" style="padding:1px;" onclick="CollapseLevel(9)">
  </span>
</div>
<table style="width:98%; padding-right: 6px;" cellspacing="0" cellpadding="0">
    <tr>
      <td style="width: 35px;">
        &nbsp;
      </td>
      <td>
        <div id="Canvas" class="Canvas"></div>
      </td>
    </tr>
  </table>
</body>
</html>
